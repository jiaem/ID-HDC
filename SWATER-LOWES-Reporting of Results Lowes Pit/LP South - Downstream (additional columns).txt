let samples = Samples.Raw(Form.[SWATER-LOWES-M3-Reporting of Results Lowes Pit].[LP South - Downstream], report.starts, report.ends)
let sampleDate = Samples.Raw(Form.[SWATER-LOWES-M3-Reporting of Results Lowes Pit].[Date of sampling], report.starts, report.ends)
let receivedDate = Samples.Raw(Form.[SWATER-LOWES-M3-Reporting of Results Lowes Pit].[Date of results received], report.starts, report.ends)
let sentDate = Samples.Raw(Form.[SWATER-LOWES-M3-Reporting of Results Lowes Pit].[Date of results sent to HBRC], report.starts, report.ends)
let notified = Samples.Raw(Form.[SWATER-LOWES-M3-Reporting of Results Lowes Pit].[Has HBRC been notified of results within 7 days?], report.starts, report.ends)

Table.RowHeaders("Date")
Table.Headers("Sample Date", "Date of results received", "Date of results sent to HBRC", "Submitted", "Submitted within 7 days?")
init i = 1

if (list.get(samples,0) != null) then

	//Sampler.Reset(samples)
	loop while Sampler.Next(samples) or Sampler.Next(sampleDate) or Sampler.Next(receivedDate) or Sampler.Next(sentDate) or Sampler.Next(Samples.Raw(Form.[SWATER-LOWES-M3-Reporting of Results Lowes Pit].[Has HBRC been notified of results within 7 days?], report.starts, report.ends))
		if (list.get(samples,0) != null) then
			if (Sampler.Value(samples) = True) then
				let d = Time.Day(Time.UtcToTimezone(Sampler.Stamp(samples),This.Timezone))
				let m = Time.Month(Time.UtcToTimezone(Sampler.Stamp(samples),This.Timezone))
				let y = Time.Year(Time.UtcToTimezone(Sampler.Stamp(samples),This.Timezone))

				//Date
				Table.Row(i, d + "-" + m  + "-" + y)

				//Date sampled
				Table.Cell(i,1,Sampler.Value(SampleDate))

				//Date results received
				Table.Cell(i,2,Sampler.Value(receivedDate))

				//Date results sent
				Table.Cell(i,3,Sampler.Value(sentDate))

				//Submitted
				Table.Cell(i,4,1)

				//Submitted within 7 days?

				Table.Cell(i,5,Sampler.Value(Samples.Raw(Form.[SWATER-LOWES-M3-Reporting of Results Lowes Pit].[Has HBRC been notified of results within 7 days?], report.starts, report.ends)))

				//Fails
				Table.CellFails(i,2,Sampler.Value(Samples.Raw(Form.[SWATER-LOWES-M3-Reporting of Results Lowes Pit].[Has HBRC been notified of results within 7 days?], report.starts, report.ends)) = "No")
				Table.CellFails(i,3,Sampler.Value(Samples.Raw(Form.[SWATER-LOWES-M3-Reporting of Results Lowes Pit].[Has HBRC been notified of results within 7 days?], report.starts, report.ends)) = "No")
				Table.CellFails(i,5,Sampler.Value(Samples.Raw(Form.[SWATER-LOWES-M3-Reporting of Results Lowes Pit].[Has HBRC been notified of results within 7 days?], report.starts, report.ends)) = "No")

			let i = i+1
			endif
		endif
	endloop

else

	Table.Row(1,"N/A")
	Table.Cell(1,1,"N/A")
	Table.Cell(1,2,"N/A")
	Table.Cell(1,3,"N/A")
	Table.Cell(1,4,"No Reports submitted")
	Table.Cell(1,5,"N/A")
	Table.CellFails(1,1,TRUE)
	Table.CellFails(1,2,TRUE)
	Table.CellFails(1,3,TRUE)
	Table.CellFails(1,4,TRUE)
	Table.CellFails(1,5,TRUE)
	Table.RowFails(1,TRUE)
	Table.Fails(TRUE)
endif
